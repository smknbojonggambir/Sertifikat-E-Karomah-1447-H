<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Portal E-Karomah 1447 H</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif}

body{
min-height:100vh;
display:flex;
flex-direction:column;
align-items:center;
padding:40px 20px;
background:linear-gradient(180deg,#0f2027,#203a43,#2c5364);
color:#fff;
}

/* ===== SEARCH BOX ===== */
.search-box{
background:#fff;
color:#1f2937;
padding:35px;
border-radius:20px;
width:100%;
max-width:450px;
text-align:center;
box-shadow:0 15px 40px rgba(0,0,0,.2);
margin-bottom:40px;
}

.search-box h2{color:#059669;margin-bottom:5px}
.search-box p{font-size:14px;color:#6b7280;margin-bottom:20px}

input{
width:100%;
padding:14px;
border-radius:10px;
border:2px solid #e5e7eb;
margin-bottom:15px;
font-size:15px;
}

input:focus{
outline:none;
border-color:#059669;
}

button{
width:100%;
padding:14px;
border:none;
border-radius:10px;
background:#059669;
color:#fff;
font-weight:600;
cursor:pointer;
transition:.3s;
}

button:hover{background:#047857}
button:disabled{background:#9ca3af}

.error{color:#dc2626;font-size:13px;margin-top:10px}

/* ===== DOCUMENT WRAPPER ===== */
#document-wrapper{
display:none;
flex-direction:column;
gap:40px;
width:100%;
max-width:1100px;
}

/* ===== CANVAS COMMON ===== */
.certificate, .laporan{
background-image:url('https://raw.githubusercontent.com/smknbojonggambir/Sertifikat-E-Karomah-1447-H/main/background.jpg');
background-size:cover;
background-position:center;
background-repeat:no-repeat;
box-shadow:0 10px 30px rgba(0,0,0,.3);
color:#1f2937;
}

/* ===== CERTIFICATE ===== */
.certificate{
width:1000px;
height:707px;
padding:60px;
position:relative;
background-color:white;
}

.certificate h1{
text-align:center;
font-size:40px;
color:#059669;
margin-top:120px;
}

.certificate h2{
text-align:center;
font-size:32px;
margin:15px 0;
}

.certificate p{text-align:center;font-size:18px}

.logo{
position:absolute;
top:40px;
left:60px;
height:80px;
}

/* ===== LAPORAN ===== */
.laporan{
width:794px;
height:1123px;
padding:70px 60px;
background-color:white;
}

.laporan h2{
text-align:center;
color:#059669;
margin-bottom:30px;
}

.tabel{
width:100%;
border-collapse:collapse;
background:rgba(255,255,255,.9);
}

.tabel th,.tabel td{
border:1px solid #ccc;
padding:12px;
}

.tabel th{
background:#059669;
color:white;
}

.total{
font-weight:700;
color:#059669;
}

/* SCROLL MOBILE */
.canvas-wrap{
overflow:auto;
}
</style>
</head>
<body>

<div class="search-box">
<h2>Cetak Dokumen</h2>
<p>E-Karomah 1447 H / 2026 M</p>
<input type="text" id="input-nama" placeholder="Masukkan Nama Lengkap">
<button onclick="cariSertifikat()" id="btn-cari">
<i class="fa-solid fa-magnifying-glass"></i> Cari Data
</button>
<p id="pesan-error" class="error"></p>
</div>

<div id="document-wrapper">

<div class="canvas-wrap">
<div id="certificate-canvas" class="certificate">
<img src="https://raw.githubusercontent.com/smknbojonggambir/Sertifikat-E-Karomah-1447-H/main/logo-smk.png" class="logo">
<h1>SERTIFIKAT PENGHARGAAN</h1>
<p>Nomor: <span id="cert-nomor"></span></p>
<p>Diberikan kepada:</p>
<h2 id="cert-nama">Nama Peserta</h2>
<p>Sebagai:</p>
<p><b id="cert-sebagai">Peserta</b></p>
</div>
</div>

<button onclick="downloadGambar('certificate-canvas','Sertifikat','btn-cari')">
Unduh Sertifikat
</button>

<div class="canvas-wrap">
<div id="laporan-canvas" class="laporan">
<h2>LAPORAN HASIL EVALUASI</h2>

<p><b>Nama:</b> <span id="lap-nama"></span></p>
<p><b>Nomor:</b> <span id="lap-nomor"></span></p>

<table class="tabel">
<tr><th>Aspek</th><th>Nilai</th></tr>
<tr><td>Kedisiplinan</td><td id="lap-kedisiplinan"></td></tr>
<tr><td>Kelengkapan</td><td id="lap-kelengkapan"></td></tr>
<tr><td>Ibadah</td><td id="lap-ibadah"></td></tr>
<tr class="total"><td>Rata-rata</td><td id="lap-ratarata"></td></tr>
<tr class="total"><td>Predikat</td><td id="lap-predikat"></td></tr>
</table>

</div>
</div>

<button onclick="downloadGambar('laporan-canvas','Laporan','btn-cari')">
Unduh Laporan
</button>

</div>

<script>
const scriptURL='https://script.google.com/macros/s/AKfycbyirBD6i2yNRnsWEgJG9HeE7_nbaC5nL-FAgyd71OwwRdIlP3wBgf4r1zXyKnyU14rOmw/exec';

async function cariSertifikat(){
const nama=document.getElementById('input-nama').value;
const err=document.getElementById('pesan-error');
const wrap=document.getElementById('document-wrapper');

if(!nama){
err.innerText="Nama tidak boleh kosong!";
wrap.style.display='none';
return;
}

try{
const res=await fetch(`${scriptURL}?nama=${encodeURIComponent(nama)}`);
const data=await res.json();

if(data.status==='success'){
document.getElementById('cert-nama').innerText=data.data.nama;
document.getElementById('cert-sebagai').innerText=data.data.sebagai;
document.getElementById('cert-nomor').innerText=data.data.nomor;

document.getElementById('lap-nama').innerText=data.data.nama;
document.getElementById('lap-nomor').innerText=data.data.nomor;
document.getElementById('lap-kedisiplinan').innerText=data.data.kedisiplinan;
document.getElementById('lap-kelengkapan').innerText=data.data.kelengkapan;
document.getElementById('lap-ibadah').innerText=data.data.ibadah;
document.getElementById('lap-ratarata').innerText=data.data.ratarata;
document.getElementById('lap-predikat').innerText=data.data.predikat;

wrap.style.display='flex';
}else{
err.innerText="Data tidak ditemukan.";
wrap.style.display='none';
}
}catch(e){
err.innerText="Gagal terhubung ke server.";
wrap.style.display='none';
}
}

function downloadGambar(id,file){
const node=document.getElementById(id);
html2canvas(node,{scale:2,useCORS:true}).then(canvas=>{
const link=document.createElement('a');
link.download=file+".jpg";
link.href=canvas.toDataURL("image/jpeg",1);
link.click();
});
}
</script>

</body>
</html>
